name: üèÜ Daily Creep Leaderboard

on:
  schedule:
    # Every day at 18:45 JST (09:45 UTC)
    - cron: '45 9 * * *'
  workflow_dispatch:

jobs:
  generate-leaderboard:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: üèÜ Generate Daily Achievements
        uses: actions/github-script@v8
        with:
          script: |
            const achievements = [
              { emoji: 'üöÄ', name: 'Speed Demon', desc: 'Move 500 tiles in one day' },
              { emoji: '‚õèÔ∏è', name: 'Mining Master', desc: 'Harvest 5000 energy' },
              { emoji: 'üè≠', name: 'Architect', desc: 'Build 10 structures' },
              { emoji: 'üîß', name: 'Repairman', desc: 'Repair 3000 hit points' },
              { emoji: 'üåü', name: 'Controller King', desc: 'Upgrade controller 50 times' },
              { emoji: 'üîç', name: 'Explorer', desc: 'Discover a new room' },
              { emoji: 'üõ°Ô∏è', name: 'Defender', desc: 'Eliminate a hostile creep' },
              { emoji: 'üíä', name: 'Healer', desc: 'Heal 2000 hit points' }
            ];
            
            const dailyChallenge = achievements[Math.floor(Math.random() * achievements.length)];
            
            console.log(`üéØ Today's Challenge: ${dailyChallenge.emoji} ${dailyChallenge.name}`);
            console.log(`   ${dailyChallenge.desc}`);

      - name: üìù Create Daily Challenge File
        run: |
          cat > daily-challenge.js << 'EOF'
          // Daily Challenge System
          // Auto-generated by Daily Leaderboard workflow
          
          module.exports = {
            getChallenge: function() {
              const today = new Date().toISOString().split('T')[0];
              
              if (!Memory.dailyChallenge || Memory.dailyChallenge.date !== today) {
                const challenges = [
                  { emoji: 'üöÄ', name: 'Speed Demon', desc: 'Move 500 tiles', metric: 'moves', target: 500 },
                  { emoji: '‚õèÔ∏è', name: 'Mining Master', desc: 'Harvest 5000 energy', metric: 'harvested', target: 5000 },
                  { emoji: 'üè≠', name: 'Architect', desc: 'Build 10 structures', metric: 'built', target: 10 },
                  { emoji: 'üîß', name: 'Repairman', desc: 'Repair 3000 HP', metric: 'repaired', target: 3000 },
                  { emoji: 'üåü', name: 'Controller King', desc: 'Upgrade 50 times', metric: 'upgrades', target: 50 }
                ];
                
                const dayOfYear = Math.floor((new Date() - new Date(new Date().getFullYear(), 0, 0)) / 86400000);
                const challenge = challenges[dayOfYear % challenges.length];
                
                Memory.dailyChallenge = {
                  date: today,
                  challenge: challenge,
                  progress: 0,
                  completed: false
                };
              }
              
              return Memory.dailyChallenge;
            },
            
            updateProgress: function(metric, amount) {
              const challenge = this.getChallenge();
              
              if (challenge.challenge.metric === metric && !challenge.completed) {
                challenge.progress += amount;
                
                if (challenge.progress >= challenge.challenge.target) {
                  challenge.completed = true;
                  console.log(`üéâ CHALLENGE COMPLETE! ${challenge.challenge.emoji} ${challenge.challenge.name}`);
                }
              }
            },
            
            displayChallenge: function() {
              const challenge = this.getChallenge();
              const c = challenge.challenge;
              const percent = Math.min(100, Math.floor((challenge.progress / c.target) * 100));
              
              console.log(`\nüéØ TODAY'S CHALLENGE: ${c.emoji} ${c.name}`);
              console.log(`   ${c.desc}`);
              console.log(`   Progress: ${challenge.progress}/${c.target} (${percent}%)`);
              
              if (challenge.completed) {
                console.log(`   ‚úÖ COMPLETED!`);
              }
            }
          };
          EOF
          
      - name: Commit daily challenge
        run: |
          git config user.name "Leaderboard Bot"
          git config user.email "actions@github.com"
          git add daily-challenge.js
          git diff --staged --quiet || git commit -m "üèÜ Daily challenge generated [$(date +'%Y-%m-%d')]"
          git push
